<html>
    <head>
        <meta charset="utf8">
        <link rel="stylesheet" href="index.css">
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="/modules/"></script>

    </head>
    
    <body>
        <section id="main">
            <h3 class="title" id="show-datasets">Datasets</h3>

            Table of datasets to browse will go here.

            <h3 class="title" id="register-datasets">Register Dataset</h3>
            <form method="post" action="/do/datasets/register">

                <input id="user_id" name="user_id" type="number" hidden/>

                <label for="provider">Provider</label><br>
                <input id="provider" name="provider" type="text"/><br>
                <br>

                <label for="name">Name (of dataset)</label><br>
                <input id="name" name="name" type="text"/><br>
                <br>

                <label for="institution">Institution of origin</label><br>
                <input id="institution" name="institution" type="text"/><br>
                <br>

                <label for="principal_investigator">Principal investigator</label><br>
                <input id="principal_investigator" name="principal_investigator" type="text"/><br>
                <br>


                <label for="source">Source</label><br>
                <input id="source" name="source" type="text"/><br>
                <br>
                
                <label for="datatype">Evidence type</label><br>
                <input id="datatype" name="datatype" type="text"/><br>
                <br>

                <!-- The collection state is autogenerated - I suppose -->
                <!-- <label for="state">Collection status</label><br>
                <input id="state" name="state" type="text"/><br>
                <br> -->

                <label for="embargo_date">Availability</label><br>
                    <!-- Choice as to where to set an embargo -->
                <input id="embargo_date" name="embargo_date" type="date"/><br>
                <br>

                <input id="submit" type="submit" name="action" value="Register"/>

            </form>
        </section>
    </body>
    <script>

        const url =  new URL(window.location.href);
        const user_id = url.searchParams.get("user");

        function displayDatasets(datasets) {};
        function displayUsers(username) {
            document.getElementById('provider').value = username;
        }
        
        if (user_id) {
            console.log('userid exists, it is', user_id)
            document.getElementById('user_id').value = user_id;

            const json = fetch(`/datasets/${user_id}`)
                .then(b => b.json())
                .then(displayDatasets)
                .catch(console.warn);

            // TODO: draw out from session?!? Is this insecure?
            const username = fetch(`/users/${user_id}/username`)
                .then(b => b.json())
                .then(displayUsers)
                .catch(console.warn);
            
        } else {
            console.warn('No user_id given on the datasets page!')
        }

    </script>
</html>